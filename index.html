<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テキスト整形くん 校閲Pro</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="light-mode">
<div class="container">
    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 10px;">
        <button id="modeBtn">🌙 ダークモード</button>
        <button id="clearBtn">🗑️ 全削除</button>
    </div>
    
    <h1>テキスト整形くん 校閲Pro</h1>

    <details>
        <summary>🔧 チーム同期・基本設定</summary>
        <div class="details-content" style="font-size: 0.8rem; background: var(--config-bg); display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            <div>トークン: <input type="password" id="githubToken" oninput="saveSettings()" style="width:100%;"></div>
            <div>ユーザー: <input type="text" id="githubUser" oninput="saveSettings()" value="sakumaaaaa" style="width:100%;"></div>
            <div>リポジトリ: <input type="text" id="githubRepo" oninput="saveSettings()" value="text-formatting-tool" style="width:100%;"></div>
        </div>
    </details>

    <details id="listDetails">
        <summary>📚 各種リストの同期・管理</summary>
        <div class="details-content list-grid">
            <div class="list-box" style="background:var(--list-bg)">
                <label><span>1. 保護リスト (維持)</span><span id="status_whitelist" class="list-status status-init">☁️ 未読込</span></label>
                <input type="text" id="search_whitelist" style="padding:4px; font-size:0.8rem;" placeholder="保護語を検索..." oninput="filterList()">
                <textarea id="whitelist" style="height: 120px;" oninput="onListInput()"></textarea>
                <button class="btn-sync" onclick="syncList('common_list.txt', 'whitelist')">☁️ 同期</button>
            </div>
            <div class="list-box" style="background:var(--replace-bg)">
                <label><span>2. 共通マスタ置換</span><span id="status_replaceList" class="list-status status-init">☁️ 未読込</span></label>
                <textarea id="replaceList" style="height: 120px;" oninput="checkUnsaved('replaceList')"></textarea>
                <button class="btn-assist" onclick="suggestRules()">📋 整形結果から置換案を抽出</button>
                <div id="assistPanel" style="display:none; background:rgba(0,0,0,0.05); padding:10px; border-radius:4px; font-size:0.8rem;">
                    <div id="assistList" style="max-height:100px; overflow-y:auto; margin-bottom:5px;"></div>
                    <button onclick="applySuggestions()" style="background:var(--accent-green); padding:4px 8px; font-size:10px;">✅ 追加</button>
                </div>
                <button class="btn-sync" onclick="syncList('replace_list.txt', 'replaceList')">☁️ 同期</button>
            </div>
            <div class="list-box" style="background:var(--presets-bg)">
                <label><span>3. スタイル定義 (Text)</span><span id="status_presetsJson" class="list-status status-init">☁️ 未読込</span></label>
                <textarea id="presetsJson" style="height: 120px;" oninput="checkUnsaved('presetsJson')"></textarea>
                <button class="btn-sync" onclick="syncList('presets.json', 'presetsJson')">☁️ 同期</button>
            </div>
        </div>
    </details>

    <details>
        <summary>🔡 記号・組版オプション</summary>
        <div class="details-content options-grid" id="optionsGrid">
            <div class="opt-item"><span>％ パーセント</span><select id="opt_percent"><option value="zen">全角 ％</option><option value="han">半角 %</option></select></div>
            <div class="opt-item"><span>＆ アンパサンド</span><select id="opt_ampersand"><option value="zen">全角 ＆</option><option value="han">半角 &</option></select></div>
            <div class="opt-item"><span>（ ）カッコ</span><select id="opt_bracket"><option value="zen">全角 （ ）</option><option value="han">半角 ( )</option></select></div>
            <div class="opt-item"><span>： コロン</span><select id="opt_colon"><option value="zen">全角 ：</option><option value="han">半角 :</option></select></div>
            <div class="opt-item"><span>読点</span><select id="opt_comma"><option value="ten">テン 、</option><option value="comma">カンマ ，</option></select></div>
            <div class="opt-item"><span>引用符</span><select id="opt_quote"><option value="zen">全角 “”</option><option value="han">半角 ""</option></select></div>
            <div class="opt-item"><span>― ダーシ</span><select id="opt_dash"><option value="zen">全角 ―</option><option value="han">半角 -</option></select></div>
            <div class="opt-item"><span>- ハイフン</span><select id="opt_hyphen"><option value="han">半角 -</option><option value="zen">全角 －</option></select></div>
            <div class="opt-item"><span>／ スラッシュ</span><select id="opt_slash"><option value="han">半角 /</option><option value="zen">全角 ／</option></select></div>
            <div class="opt-item"><span>＝ 等号</span><select id="opt_equal"><option value="han">半角 =</option><option value="zen">全角 ＝</option></select></div>
            <div class="opt-item"><span>感嘆疑問 ！ ？</span><select id="opt_mark"><option value="zen">全角 ！ ？</option><option value="han">半角 ! ?</option></select></div>
            <div class="opt-item"><span>！ ？ 後の空き</span><select id="opt_mark_space"><option value="keep">維持</option><option value="force">全角アキ強制</option><option value="none">詰める</option></select></div>
        </div>
    </details>

    <div class="controls">
        <div>スタイル: <select id="activeStyle" class="style-select"><option value="none">なし (整形のみ)</option><option value="汎用（英名）">汎用（英名）</option><option value="汎用（和名）">汎用（和名）</option><option value="サイエンス">サイエンス</option><option value="大山レポート">大山レポート</option></select></div>
        <label class="compare-mode"><input type="checkbox" id="compareMode" checked> 比較・注釈モード</label>
    </div>

    <h2>① 原文を貼り付け</h2>
    <textarea id="input" placeholder="テキストを貼り付けてください..."></textarea>
    
    <div class="button-main">
        <button class="btn-exec" onclick="processText()">✨ 整形・校閲を実行</button>
        <button class="btn-copy">📋 結果をコピー</button>
        <button class="btn-save" onclick="downloadTxt()">💾 保存</button>
    </div>

    <h2>② 整形・校閲結果</h2>
    <div style="margin-bottom: 10px;"><span id="charCount" class="counter-badge">文字数: 0</span></div>
    <div id="output"></div>
</div>
<script src="script.js"></script>
<script>
    // index.html専用の微調整
    document.getElementById('clearBtn').onclick = () => { if(confirm('消去しますか？')){document.getElementById('input').value='';document.getElementById('output').innerText='';} };
    document.querySelector('.btn-copy').onclick = copyToClipboard;
</script>
</body>
</html>
