<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テキスト整形くん 校閲Pro (v31.0)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="light-mode">
<div class="container">
    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 10px;">
        <button id="modeBtn">🌙 ダークモード</button>
        <button id="clearBtn">🗑️ 全削除</button>
    </div>
    
    <h1>テキスト整形くん 校閲Pro <span style="font-size:0.6em; color:var(--accent-red); vertical-align:middle;">v31.0 Ghost Buster</span></h1>

    <details>
        <summary>🔧 チーム同期・基本設定</summary>
        <div class="details-content" style="font-size: 0.8rem; background: var(--config-bg); display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            <div>トークン: <input type="password" id="githubToken" oninput="saveSettings()" style="width:100%;"></div>
            <div>ユーザー: <input type="text" id="githubUser" oninput="saveSettings()" value="sakumaaaaa" style="width:100%;"></div>
            <div>リポジトリ: <input type="text" id="githubRepo" oninput="saveSettings()" value="text-formatting-tool" style="width:100%;"></div>
        </div>
    </details>

    <details id="listDetails" open>
        <summary>📚 各種リストの同期・管理</summary>
        <div class="details-content list-grid">
            <!-- 1. English/Name Master (Box 1: Blue) -->
            <div class="list-box" style="background:var(--box1-bg); border-color:var(--box1-border);">
                <label title="表記ゆれを修正し、正式な英語名称に統一します。">
                    <span>1. 英語・名称マスタ (整地)</span>
                    <div class="list-header-right">
                        <button class="btn-icon" onclick="openModal('companyList', '1. 英語・名称マスタ')">🔍</button>
                        <span id="status_companyList" class="list-status status-init">☁️ 未読込</span>
                    </div>
                </label>
                <textarea id="companyList" style="height: 145px;" oninput="onListInput('companyList')" placeholder="In tel > Intel"></textarea>
                <button class="btn-sync" onclick="syncList('company_list.txt', 'companyList')">☁️ 同期</button>
            </div>

            <!-- 2. Protection List (Box 2: Purple) -->
            <div class="list-box" style="background:var(--box2-bg); border-color:var(--box2-border);">
                <label title="ここに登録された語は、入力が崩れていても強制的にこの形に復元され、保護されます。">
                    <span>2. 保護ワード (絶対復元)</span>
                    <div class="list-header-right">
                        <button class="btn-icon" onclick="openModal('whitelist', '2. 保護ワード')">🔍</button>
                        <span id="status_whitelist" class="list-status status-init">☁️ 未読込</span>
                    </div>
                </label>
                <input type="text" id="search_whitelist" style="padding:4px; font-size:0.8rem;" placeholder="保護語を検索..." oninput="filterList()">
                <textarea id="whitelist" style="height: 120px;" oninput="onListInput('whitelist')" placeholder="GaN HEMT&#10;Galaxy AI"></textarea>
                <button class="btn-sync" onclick="syncList('common_list.txt', 'whitelist')">☁️ 同期</button>
            </div>
            
            <!-- 3. Replace Master (Box 3: Green) -->
            <div class="list-box" style="background:var(--box3-bg); border-color:var(--box3-border);">
                <label title="一般的な用語の表記揺れを統一します。">
                    <span>3. 共通置換ルール (置換)</span>
                    <div class="list-header-right">
                        <button class="btn-icon" onclick="openModal('replaceList', '3. 共通置換ルール')">🔍</button>
                        <span id="status_replaceList" class="list-status status-init">☁️ 未読込</span>
                    </div>
                </label>
                <textarea id="replaceList" style="height: 120px;" oninput="checkUnsaved('replaceList'); checkConflicts();" placeholder="コンピューター > コンピュータ"></textarea>
                <button class="btn-assist" onclick="suggestRules()">📋 整形結果から置換案を抽出</button>
                <div id="assistPanel" style="display:none; background:rgba(0,0,0,0.05); padding:10px; border-radius:4px; font-size:0.8rem;">
                    <div id="assistList" style="max-height:100px; overflow-y:auto; margin-bottom:5px;"></div>
                    <button onclick="applySuggestions()" style="background:var(--accent-green); padding:4px 8px; font-size:10px;">✅ 追加</button>
                </div>
                <button class="btn-sync" onclick="syncList('replace_list.txt', 'replaceList')">☁️ 同期</button>
            </div>

            <!-- 4. Presets (Box 4: Orange) -->
            <div class="list-box" style="background:var(--box4-bg); border-color:var(--box4-border);">
                <label title="媒体ごとのルールで最終的な仕上げを行います。">
                    <span>4. 媒体別スタイル (仕上げ)</span>
                    <div class="list-header-right">
                        <button class="btn-icon" onclick="openModal('presetsJson', '4. 媒体別スタイル')">🔍</button>
                        <span id="status_presetsJson" class="list-status status-init">☁️ 未読込</span>
                    </div>
                </label>
                <textarea id="presetsJson" style="height: 145px;" oninput="checkUnsaved('presetsJson')" placeholder="[Style]&#10;Apple > 米Apple"></textarea>
                <button class="btn-sync" onclick="syncList('presets.json', 'presetsJson')">☁️ 同期</button>
            </div>
        </div>
        <div id="conflictAlert" style="display:none; background:#fff3cd; color:#856404; padding:8px; margin-top:10px; border-radius:4px; font-size:0.85rem; border:1px solid #ffeeba;">
            ⚠️ 警告: リスト間で競合が発生しています。
        </div>
    </details>

    <details>
        <summary>🔡 記号・組版オプション</summary>
        <div class="details-content">
            <div class="options-grid" id="optionsGrid">
                <div class="opt-item"><span>％ パーセント</span><select id="opt_percent"><option value="zen">全角 ％</option><option value="han">半角 %</option></select></div>
                <div class="opt-item"><span>＆ アンパサンド</span><select id="opt_ampersand"><option value="zen">全角 ＆</option><option value="han">半角 &</option></select></div>
                <div class="opt-item"><span>（ ）カッコ</span><select id="opt_bracket"><option value="zen">全角 （ ）</option><option value="han">半角 ( )</option></select></div>
                <div class="opt-item"><span>： コロン</span><select id="opt_colon"><option value="zen">全角 ：</option><option value="han">半角 :</option></select></div>
                <div class="opt-item"><span>読点・句点</span><select id="opt_punctuation"><option value="ten_maru">テン・マル 、。</option><option value="comma_maru">カンマ・マル ，。</option><option value="comma_period">カンマ・ピリ ，．</option></select></div>
                <div class="opt-item"><span>引用符</span><select id="opt_quote"><option value="zen">全角 “”</option><option value="han">半角 ""</option></select></div>
                <div class="opt-item"><span>～ 波ダーシ</span><select id="opt_wave"><option value="wave">波ダーシ 〜</option><option value="tilde">全角チルダ ～</option></select></div>
                <div class="opt-item"><span>― ダーシ</span><select id="opt_dash"><option value="zen">全角 ―</option><option value="han">半角 -</option></select></div>
                <div class="opt-item"><span>- ハイフン</span><select id="opt_hyphen"><option value="han">半角 -</option><option value="zen">全角 －</option></select></div>
                <div class="opt-item"><span>／ スラッシュ</span><select id="opt_slash"><option value="han">半角 /</option><option value="zen">全角 ／</option></select></div>
                <div class="opt-item"><span>＝ 等号</span><select id="opt_equal"><option value="han">半角 =</option><option value="zen">全角 ＝</option></select></div>
                <div class="opt-item"><span>感嘆疑問 ！ ？</span><select id="opt_mark"><option value="zen">全角 ！ ？</option><option value="han">半角 ! ?</option></select></div>
                <div class="opt-item"><span>！ ？ 後の空き</span><select id="opt_mark_space"><option value="keep">維持</option><option value="force">全角アキ強制</option><option value="none">詰める</option></select></div>
            </div>
            <div style="margin-top:15px; padding-top:10px; border-top:1px dashed var(--border-color);">
                <div style="display:flex; justify-content:flex-end; align-items:center; margin-bottom:10px;">
                    <span id="updateLabel" style="font-size:0.8rem; margin-right:10px; color:#666;">適用中のスタイルを更新:</span>
                    <button id="btnUpdateStyle" onclick="updateCurrentStyle()" style="background:var(--accent-orange); padding:5px 10px; font-size:0.8rem;" disabled>🔄 選択されていません</button>
                </div>
                <div style="display:flex; justify-content:flex-end; align-items:center; gap:10px;">
                    <span style="font-size:0.8rem; font-weight:bold; color:var(--accent-purple);">現在の設定で新規作成:</span>
                    <input type="text" id="newStyleName" placeholder="新規スタイル名" style="padding:4px; font-size:0.8rem; width:150px;">
                    <button onclick="createNewStyle()" style="background:var(--accent-purple); padding:5px 10px; font-size:0.8rem;">💾 新規作成</button>
                </div>
            </div>
        </div>
    </details>

    <div class="controls">
        <div style="flex-grow:1;">
            <label style="font-weight:bold; font-size:0.9rem;">適用スタイル:</label>
            <select id="activeStyle" class="style-select" onchange="applyStyle(this.value)">
                <option value="none">なし (単純整形のみ)</option>
            </select>
            <span id="styleInfo" style="font-size:0.8rem; color:#666; margin-left:10px;"></span>
        </div>
        <label class="compare-mode"><input type="checkbox" id="compareMode" checked> 比較・注釈モード</label>
    </div>

    <h2>① 原文を貼り付け</h2>
    <textarea id="input" placeholder="テキストを貼り付けてください..."></textarea>
    
    <div class="button-main">
        <button class="btn-exec" onclick="processText()">✨ 整形・校閲を実行</button>
        <button class="btn-copy">📋 結果をコピー</button>
        <button class="btn-save" onclick="downloadTxt()">💾 保存</button>
    </div>

    <h2>② 整形・校閲結果</h2>
    <div style="margin-bottom: 10px;"><span id="charCount" class="counter-badge">文字数: 0</span></div>
    <div id="output"></div>
</div>

<!-- Modal -->
<div id="editorModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">リスト編集</h3>
            <button onclick="closeModal()" class="btn-icon">✖</button>
        </div>
        <div class="modal-body">
            <div class="modal-tools">
                <button class="btn-icon" onclick="sortModalList()">🔽 A-Z ソート</button>
                <button class="btn-icon" onclick="uniqueModalList()">🧹 重複削除</button>
            </div>
            <textarea id="modalTextarea"></textarea>
        </div>
        <div class="modal-footer">
            <button onclick="closeModal()" style="background:#6c757d; padding:8px 16px;">キャンセル</button>
            <button onclick="saveModal()" style="background:var(--accent-blue); padding:8px 16px;">💾 反映して閉じる</button>
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
    document.getElementById('clearBtn').onclick = () => { if(confirm('消去しますか？')){document.getElementById('input').value='';document.getElementById('output').innerText='';} };
    document.querySelector('.btn-copy').onclick = copyToClipboard;
</script>
</body>
</html>
