<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テキスト整形ツール</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 0 10px; }
        textarea { width: 100%; height: 200px; margin-bottom: 10px; }
        .buttons { margin-bottom: 20px; }
        button { padding: 10px 20px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        #output { background: #f8f9fa; padding: 15px; border: 1px solid #ddd; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>テキスト整形くん</h1>
    <p>① テキストを入力してください</p>
    <textarea id="input" placeholder="ここにテキストをペースト..."></textarea>
    
    <div class="buttons">
        <button onclick="processText()">整形する</button>
        <button onclick="downloadTxt()" style="background:#28a745;">.txtをダウンロード</button>
    </div>

    <p>② 整形結果</p>
    <div id="output"></div>

    <script>
        function processText() {
            let text = document.getElementById('input').value;

            // 1. 余計な改行の削除（連続する改行を1つに。または完全に消す場合は '' に変更）
            text = text.replace(/\n\s*\n/g, '\n');

            // 2. 「A p p l e」などの1文字ずつの間にある半角スペースを除去
            // 前後が英字1文字の場合のスペースのみを消す（単語間のスペースは残す）
            text = text.replace(/(?<=[a-zA-Z])\s(?=[a-zA-Z](?!\S))/g, '');
            
            // 全角文字の間にあるスペースも消したい場合はこちらを追加
            text = text.replace(/(?<=[\u3040-\u30ff\u4e00-\u9faf])\s(?=[\u3040-\u30ff\u4e00-\u9faf])/g, '');

            document.getElementById('output').innerText = text;
        }

        function downloadTxt() {
            const text = document.getElementById('output').innerText;
            if (!text) { alert("整形後のテキストがありません"); return; }
            
            const blob = new Blob([text], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'cleaned_text.txt';
            a.click();
        }
    </script>
</body>
</html>